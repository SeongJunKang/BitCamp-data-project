<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<link rel="stylesheet" href="../bower_components/bootstrap/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="../bower_components/bootstrap/dist/css/bootstrap-theme.min.css">
<link rel="stylesheet" type="text/css" href="../headerStyle.css">
<link rel="stylesheet" type="text/css" href="../footerStyle.css">
<link rel="stylesheet"   href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script src="http://apis.daum.net/maps/maps3.js?apikey=7ae134637aef8f4bb01892e30a801547&libraries=services"></script>
<script src="../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="../bower_components/handlebars/handlebars.min.js"></script>
<script src="http://code.jquery.com/jquery-latest.min.js"></script>
  
<title>산책하개</title>
<style type="text/css">

body {
	margin-left: 20px;
	margin-right: 20px;
}

#carousel-example-generic {
	width: 100%;  
	margin: 0 auto;
}

#inbody {
  background-color: #f7f7f7 ;
}

.imgmain {
	width: 100%;
	height: auto;
	margin-bottom: 50px;
}
#bodycontent {
	width: 1100px;
	margin: 0 auto;
}

#container {
	padding-bottom: 100px;
	padding-top: 50px;
}

table {
	width: 1100px;
	margin-top: 15px;
}

.th {
	vertical-align: middle;
	width: 20%;
}

.form-control {
	margin-left: 20px;
	display: inline-block;
	width: 20%;
}
.checkbox-inline {
  margin-left: 20px;
}
#checknick {
	margin-left: 10px;
}

.thtext {
	font-weight: bold;
	font-size: 18px; vertical-align : middle;
	margin-left: 20px;
	vertical-align: middle;
}
#price {
  margin-right: 10px;
}
#profileresist {
	font-weight: bold;
	font-size: 25px;
}
#intro {
  width:  auto;
}
#savediv {
  padding-top : 30px;
  text-align: center;
}
#savebtn {
  font-size: 25px;
  color : white;
  border: none;
  background: gray;
  width: 170px;
  height: 70px;
  border-radius : 14px;
}
#savebtn:hover {
  background: orange;
  color: black;
}
.th {
  color : white;
  background-color: #f7786b;
  opacity : 0.8;
}
#map {
  margin-left: auto;
  margin-right: auto;
  width:100%;
  height:400px;
}
#addr2 {
  width: 50%;
}
#inqur1,#inqur2,#addr1{
  margin-right: 10px;
}
#radian,#range {
  text-align: right;
}
.radiandiv {
  margin-left: 100px;
} 
#radian {
  margin-right: 10px;
}
#animal {
  margin-right: 5px;
}
</style>
</head>
<body>
	<div id="inbody">
		<div id="topbanner">
			<div id="topbar">
				<p id="topbar_logo">
					<a href="#" onclick="goMain(event)"><img class="logo"
						src="../img/로고.PNG"></a>
				</p>
        <p id="topbar_button">
          <button id="logout" onclick="goMain(event)" type="button" class="btn btn-default">로그아웃</button>
        </p>
			</div>
		</div>
		<div id="container">
			<div class="carousel-example-generic">
				<img class="imgmain" src="../img/back.jpg">
			</div>
			<div id="bodycontent">
			<form >
	 	    <input id="pno" type='hidden' name='no'>
 	    </form> 
				<span id="profileresist">펫시터 프로필 등록</span>
				<div>
					<table class="table table-bordered">
						<tr>
							<td class="th"><span class="thtext">닉네임</span></td>
							<td class="td"><input type="text" class="form-control"
								id="nickname">
								<button id="checknick" class="btn btn-default">중복확인</button></td>
						</tr>
						<tr>
							<td class="th"><span class="thtext">1일 가격</span></td>
							<td class="td"><input type="text" class="form-control"
								id="price">원</td>
						</tr>
						<tr>
							<td class="th"><span class="thtext">카톡 ID</span></td>
							<td class="td"><input type="text" class="form-control"
								id="kakao"></td>
						</tr>
						<tr>
							<td class="th"><span class="thtext">은행</span></td>
							<td class="td"><input type="text" class="form-control"
								id="bank"></td>
						</tr>
						<tr>
							<td class="th"><span class="thtext">예금주</span></td>
							<td class="td"><input type="text" class="form-control"
								id="holder"></td>
						</tr>
						<tr>
							<td class="th"><span class="thtext">계좌</span></td>
							<td class="td"><input type="text" class="form-control"
								id="account"></td>
						</tr>
						<tr>
							<td class="th"><span class="thtext">추가서비스</span></td>
							<td class="td">
								<label class="checkbox-inline">
							    <input type="checkbox" name="box" id="box1" value="간식 제공">간식 제공 
							  </label>
							  <label class="checkbox-inline">
							    <input type="checkbox" name="box" id="box2" value="픽업">픽업
							  </label>
							  <label class="checkbox-inline">
							    <input type="checkbox" name="box" id="box3" value="배변봉투 제공">배변봉투 제공 
							  </label>
							  <label class="checkbox-inline">
                  <input type="checkbox" name="box"  id="box4" value="목줄/리드줄 보유">  목줄/리드줄 보유
                </label>
							  <label class="checkbox-inline">
                  <input type="checkbox" name="box"  id="box5" value="강아지 물통 보유">  강아지 물통 보유
                </label>
							</td>
						</tr>
						<tr>
							<td class="th"><span class="thtext">문의시간</span></td>
							<td class="td"><input type="text" class="form-control"
								id="inqur1">시 ~ <input type="text" class="form-control"
								id="inqur2">시</td>
						</tr>
						<tr>
							<td class="th"><span class="thtext">반려동물유무</span></td>
							<td class="td"><input type="number" class="form-control"
								id="animal"> 마리</td>
						</tr>
						<tr>
              <td class="th"><span class="thtext">우편번호</span></td>
              <td class="td"><input type="text" class="form-control" id="addr1"> <button type="button" class="btn btn-default">우편번호검색</button>
              </td>
            </tr>
            <tr>
              <td class="th"><span class="thtext">상세주소</span></td>
              <td class="td"><input type="text" class="form-control form-control2"
                id="addr2"></td>
            </tr>
						<tr>
							<td class="th" colspan="2"><span class="thtext">산책범위 지정하기</span></td>
						</tr>
						<tr>
							<td class="td" colspan="2">
							<div>
	 						  주소 : <input type="text" class="form-control" id="range">
               <button id="addrfind" class="btn btn-default">검색</button>
	 						  <span class="radiandiv">반경 : <input type="text" class="form-control" id="radian" readonly="readonly">M</span>
	 						  <span class="radiandiv"> 마우스 왼쪽(중심좌표),오른쪽(거리조절)</span>
 						  </div>
							<div id="map"></div></td>
						</tr>
						<tr>
							<td class="th" colspan="2"><span class="thtext">반려동물을 잘 산책할 수 있다는 자기 소개를 적어주세요~</span></td>
						</tr>
						<tr>
							<td colspan="2"><textarea id="intro" class="form-control" cols="150"
									rows="6"></textarea></td>
					  </tr>
					</table>
				</div>
			</div>
			<div id="savediv">
			 <button type="button" id="savebtn">저장하기</button>
			</div>
		</div>
	</div>
	<footer>

		<a href="#" onclick="goMain(event)"> <img class="logofooter"
			src="../img/로고.PNG"></a>

		<p id="copyright" class="footer">
			<br> 이 사이트의 모든 권한은 자바 80기에 있습니다.<br> 비트캠프 | 사업자등록번호: <span
				id="compno">214-85-24928</span> |(주)비트교육센터 서초지점 대표 조현정<br>
			전화번호: 02)3486-9600 | 팩스: 02)6007-1245 | 메일: bit@bitacademy.net <br>
			사업장 소재지 : 서울시 서초구 서초동 1327-15번지 비트아카데미 빌딩 3층
		</p>
	</footer>
  <script>
  
 
  
  function goMain(event) {
    location.href = "../main/maintest.html"
    event.preventDefault();
  }

  $(document).ready(function() {
  /*
           $(function() {
             $.ajax("../auth/getMemberNo.do?", {
                 method : "POST",
                 success : function(result) {
                  if (result.status == "success") {
                	  console.log(result.mno);
                  } else if ( result.status == "failure") {
                	  console.log("실패");
                  }
                }
             });
         });
         */
	  $("#savebtn").click(function() {
		    var no = location.href.split("=")[1];
		    $("#pno").val(no);
		    var checklist="";
		      $("input[name=box]:checked").each(function() {
		        checklist += $(this).val()+",";
		      });
		    checklist = checklist.substring(0,checklist.length-1);
		    var radian = 0;
		    if ($("#radian").val() != "") {
		      radian = $("#radian").val();
		    }
		      $.post("../ajax/petsitter/add.do", {
		          pno : $("#pno").val(),
		          nick : $("#nickname").val(),
		          amt :$("#price").val(),        
		          ktalk : $("#kakao").val(),
		          bank : $("#bank").val(),
		          bknm: $("#holder").val(),
		          acc : $("#account").val(),
		          ser : checklist,
		          inqur : $("#inqur1").val() + "시 ~ "
		                 +$("#inqur2").val()+ "시",
		          pet :  $( "#animal").val(),
		          addr_1 :$("#addr1").val(),
		          addr_2 :$("#addr2").val(),
		          rad : radian,
		          lat : lat,
		          lnt : lng,
		          intro :$("#intro").val()
		        }, function(result) {
		          if (result.status == "success") {
		            location.href = "../main/maintest.html";
		          } else {
		            window.alert("등록 실패입니다.");
		          }
		        }, "json");
		      $.post("../ajax/member/update.do?", {
		           no : $("#pno").val(),
		           password : "",
		           tel : "",
		           name : "",
		           gra :  2
		         }, function(result) {
		             if (result.status == "success") {
		                location.href = "../main/maintest.html";
		              } else {
		                window.alert("등록 실패입니다.");
		              }
		            }, "json");
		    });
	  
	  var lat;
	  var lng;
  //****************************************************************************
  // 다음 지도 API 키 :7ae134637aef8f4bb01892e30a801547
    var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
       mapOption = { 
         center: new daum.maps.LatLng(37.5196784,127.1201637,17), // 지도의 중심좌표
         level: 5 // 지도의 확대 레벨
       };

    // 지도를 표시할 div와  지도 옵션으로  지도를 생성합니다
    var map = new daum.maps.Map(mapContainer, mapOption); 
    var geocoder = new daum.maps.services.Geocoder();
    var zoomControl = new daum.maps.ZoomControl();
    map.addControl(zoomControl, daum.maps.ControlPosition.RIGHT);
    var mapTypeControl = new daum.maps.MapTypeControl();
    map.addControl(mapTypeControl, daum.maps.ControlPosition.TOPRIGHT);
  //****************************************************************************
  
  //****************************************************************************

  var drawingFlag = false; // 원이 그려지고 있는 상태를 가지고 있을 변수입니다
var centerPosition; // 원의 중심좌표 입니다
var drawingCircle; // 그려지고 있는 원을 표시할 원 객체입니다
var drawingLine; // 그려지고 있는 원의 반지름을 표시할 선 객체입니다
var drawingOverlay; // 그려지고 있는 원의 반경을 표시할 커스텀오버레이 입니다
var drawingDot; // 그려지고 있는 원의 중심점을 표시할 커스텀오버레이 입니다

var circles = []; // 클릭으로 그려진 원과 반경 정보를 표시하는 선과 커스텀오버레이를 가지고 있을 배열입니다

// 지도에 클릭 이벤트를 등록합니다
daum.maps.event.addListener(map, 'click', function(mouseEvent) {
	  removeCircles();    
    // 클릭 이벤트가 발생했을 때 원을 그리고 있는 상태가 아니면 중심좌표를 클릭한 지점으로 설정합니다
    if (!drawingFlag) {    
        
        // 상태를 그리고있는 상태로 변경합니다
        drawingFlag = true; 
        
        // 원이 그려질 중심좌표를 클릭한 위치로 설정합니다 
        centerPosition = mouseEvent.latLng; 

        // 그려지고 있는 원의 반경을 표시할 선 객체를 생성합니다
        if (!drawingLine) {
            drawingLine = new daum.maps.Polyline({
                strokeWeight: 3, // 선의 두께입니다
                strokeColor: '#00a0e9', // 선의 색깔입니다
                strokeOpacity: 1, // 선의 불투명도입니다 0에서 1 사이값이며 0에 가까울수록 투명합니다
                strokeStyle: 'solid' // 선의 스타일입니다
            });    
        }
        
        // 그려지고 있는 원을 표시할 원 객체를 생성합니다
        if (!drawingCircle) {                    
            drawingCircle = new daum.maps.Circle({ 
                strokeWeight: 3, // 선의 두께입니다 
                strokeColor: '#75B8FA', // 선의 색깔입니다
                strokeOpacity: 0.5, // 선의 불투명도 입니다 1에서 0 사이의 값이며 0에 가까울수록 투명합니다
                strokeStyle: 'solid', // 선의 스타일 입니다
                fillColor: '#CFE7FF', // 채우기 색깔입니다
                fillOpacity: 0.5  // 채우기 불투명도 입니다 
            });     
        }
        
        // 그려지고 있는 원의 반경 정보를 표시할 커스텀오버레이를 생성합니다
        if (!drawingOverlay) {
            drawingOverlay = new daum.maps.CustomOverlay({
                xAnchor: 0,
                yAnchor: 0,
                zIndex: 1
            });              
        }
    }
    });

// 지도에 마우스무브 이벤트를 등록합니다
// 원을 그리고있는 상태에서 마우스무브 이벤트가 발생하면 그려질 원의 위치와 반경정보를 동적으로 보여주도록 합니다
daum.maps.event.addListener(map, 'mousemove', function (mouseEvent) {
        
    // 마우스무브 이벤트가 발생했을 때 원을 그리고있는 상태이면
    if (drawingFlag) {

        // 마우스 커서의 현재 위치를 얻어옵니다 
        var mousePosition = mouseEvent.latLng; 
        
        // 그려지고 있는 선을 표시할 좌표 배열입니다. 클릭한 중심좌표와 마우스커서의 위치로 설정합니다
        var linePath = [centerPosition, mousePosition];     
        
        // 그려지고 있는 선을 표시할 선 객체에 좌표 배열을 설정합니다
        drawingLine.setPath(linePath);
        
        // 원의 반지름을 선 객체를 이용해서 얻어옵니다 
        var length = drawingLine.getLength();
        
        if(length > 0) {
            
            // 그려지고 있는 원의 중심좌표와 반지름입니다
            var circleOptions = { 
                center : centerPosition, 
            radius: length,                 
            };
            
            // 그려지고 있는 원의 옵션을 설정합니다
            drawingCircle.setOptions(circleOptions); 
                
            // 반경 정보를 표시할 커스텀오버레이의 내용입니다
            var radius = Math.round(drawingCircle.getRadius()),   
            content = '<div class="info">반경 <span class="number">' + radius + '</span>m</div>';
            
            // 반경 정보를 표시할 커스텀 오버레이의 좌표를 마우스커서 위치로 설정합니다
            drawingOverlay.setPosition(mousePosition);
            
            // 반경 정보를 표시할 커스텀 오버레이의 표시할 내용을 설정합니다
            drawingOverlay.setContent(content);
            
            // 그려지고 있는 원을 지도에 표시합니다
            drawingCircle.setMap(map); 
            
            // 그려지고 있는 선을 지도에 표시합니다
            drawingLine.setMap(map);  
            
            // 그려지고 있는 원의 반경정보 커스텀 오버레이를 지도에 표시합니다
            drawingOverlay.setMap(map);
            
        } else { 
            
            drawingCircle.setMap(null);
            drawingLine.setMap(null);    
            drawingOverlay.setMap(null);
            
        }
    }     
});     

// 지도에 마우스 오른쪽 클릭이벤트를 등록합니다
// 원을 그리고있는 상태에서 마우스 오른쪽 클릭 이벤트가 발생하면
// 마우스 오른쪽 클릭한 위치를 기준으로 원과 원의 반경정보를 표시하는 선과 커스텀 오버레이를 표시하고 그리기를 종료합니다
daum.maps.event.addListener(map, 'rightclick', function (mouseEvent) {

    if (drawingFlag) {

        // 마우스로 오른쪽 클릭한 위치입니다 
        var rClickPosition = mouseEvent.latLng; 

        // 원의 반경을 표시할 선 객체를 생성합니다
        var polyline = new daum.maps.Polyline({
            path: [centerPosition, rClickPosition], // 선을 구성하는 좌표 배열입니다. 원의 중심좌표와 클릭한 위치로 설정합니다
            strokeWeight: 3, // 선의 두께 입니다
            strokeColor: '#00a0e9', // 선의 색깔입니다
            strokeOpacity: 1, // 선의 불투명도입니다 0에서 1 사이값이며 0에 가까울수록 투명합니다
            strokeStyle: 'solid' // 선의 스타일입니다
        });
        
        // 원 객체를 생성합니다
        var circle = new daum.maps.Circle({ 
            center : centerPosition, // 원의 중심좌표입니다
            radius: polyline.getLength(), // 원의 반지름입니다 m 단위 이며 선 객체를 이용해서 얻어옵니다
            strokeWeight: 3, // 선의 두께입니다 
            strokeColor: '#75B8FA', // 선의 색깔입니다
            strokeOpacity: 0.5, // 선의 불투명도 입니다 1에서 0 사이의 값이며 0에 가까울수록 투명합니다
            strokeStyle: 'solid', // 선의 스타일 입니다
            fillColor: '#CFE7FF', // 채우기 색깔입니다
            fillOpacity: 0.5  // 채우기 불투명도 입니다  
        });
        
        var radius = Math.round(circle.getRadius()) // 원의 반경 정보를 얻어옵니다
            content = getTimeHTML(radius); // 커스텀 오버레이에 표시할 반경 정보입니다

        
        // 반경정보를 표시할 커스텀 오버레이를 생성합니다
        var radiusOverlay = new daum.maps.CustomOverlay({
            content: content, // 표시할 내용입니다
            position: rClickPosition, // 표시할 위치입니다. 클릭한 위치로 설정합니다
            xAnchor: 0,
            yAnchor: 0,
            zIndex: 1 
        });  

        // 원을 지도에 표시합니다
        circle.setMap(map); 
        
        // 선을 지도에 표시합니다
        polyline.setMap(map);
        
        // 반경 정보 커스텀 오버레이를 지도에 표시합니다
        radiusOverlay.setMap(map);
        
        // 배열에 담을 객체입니다. 원, 선, 커스텀오버레이 객체를 가지고 있습니다
        var radiusObj = {
            'polyline' : polyline,
            'circle' : circle,
            'overlay' : radiusOverlay
        };
        
        // 배열에 추가합니다
        // 이 배열을 이용해서 "모두 지우기" 버튼을 클릭했을 때 지도에 그려진 원, 선, 커스텀오버레이들을 지웁니다
        circles.push(radiusObj);   
    
        // 그리기 상태를 그리고 있지 않는 상태로 바꿉니다
        drawingFlag = false;
        lat = centerPosition.bb;
        lng = centerPosition.ab;
        // 중심 좌표를 초기화 합니다  
        centerPosition = null;
        
        // 그려지고 있는 원, 선, 커스텀오버레이를 지도에서 제거합니다
        drawingCircle.setMap(null);
        drawingLine.setMap(null);   
        drawingOverlay.setMap(null);
    }
});    
    
// 지도에 표시되어 있는 모든 원과 반경정보를 표시하는 선, 커스텀 오버레이를 지도에서 제거합니다
function removeCircles() {         
    for (var i = 0; i < circles.length; i++) {
        circles[i].circle.setMap(null);    
        circles[i].polyline.setMap(null);
        circles[i].overlay.setMap(null);
    }         
    circles = [];
}


//마우스 우클릭 하여 원 그리기가 종료됐을 때 호출하여 
//그려진 원의 반경 정보와 반경에 대한 도보, 자전거 시간을 계산하여
//HTML Content를 만들어 리턴하는 함수입니다
function getTimeHTML(distance) {

 // 도보의 시속은 평균 4km/h 이고 도보의 분속은 67m/min입니다
 var walkkTime = distance / 67 | 0;
 var walkHour = '', walkMin = '';

 // 계산한 도보 시간이 60분 보다 크면 시간으로 표시합니다
 if (walkkTime > 60) {
     walkHour = '<span class="number">' + Math.floor(walkkTime / 60) + '</span>시간 '
 }
 walkMin = '<span class="number">' + walkkTime % 60 + '</span>분'

 // 거리와 도보 시간, 자전거 시간을 가지고 HTML Content를 만들어 리턴합니다
 var content = '<ul class="info">';
 content += '    <li>';
 content += '        <span class="label">총거리</span><span class="number">' + distance + '</span>m';
 content += '    </li>';
 content += '    <li>';
 content += '        <span class="label">도보</span>' + walkHour + walkMin;
 content += '    </li>';
 content += '</ul>'
 $("#radian").val(distance);
 return content;
}

   $("#addrfind").click(function() {
	   geocoder.addr2coord($("#range").val(), function(status, result) {

		    // 정상적으로 검색이 완료됐으면 
		     if (status === daum.maps.services.Status.OK) {

		        var coords = new daum.maps.LatLng(result.addr[0].lat, result.addr[0].lng);

		        // 결과값으로 받은 위치를 마커로 표시합니다
		        var marker = new daum.maps.Marker({
		            map: map,
		            position: coords
		        });

		        // 인포윈도우로 장소에 대한 설명을 표시합니다
		        var infowindow = new daum.maps.InfoWindow({
		            content: '<div style="width:150px;text-align:center;padding:6px 0";>위치</div>'
		        });
		        infowindow.open(map, marker);

		        // 지도의 중심을 결과값으로 받은 위치로 이동시킵니다
		        map.setCenter(coords);
		    } 
		}); 
   })
  });
  </script>
</body>
</html>