-- 회원
DROP TABLE IF EXISTS MEMBER RESTRICT;

-- 펫시터
DROP TABLE IF EXISTS petsitter RESTRICT;

-- 신청
DROP TABLE IF EXISTS request RESTRICT;

-- 사용자후기
DROP TABLE IF EXISTS userreview RESTRICT;

-- 좋아요
DROP TABLE IF EXISTS likes RESTRICT;

-- 후기사진등록
DROP TABLE IF EXISTS upphoto RESTRICT;

-- 회원
CREATE TABLE MEMBER (
  MNO   INTEGER      NOT NULL COMMENT '회원번호', -- 회원번호
  EMAIL VARCHAR(40)  NOT NULL COMMENT '이메일', -- 이메일
  PWD   VARCHAR(10)  NOT NULL COMMENT '비밀번호', -- 비밀번호
  NAME  VARCHAR(100) NOT NULL COMMENT '이름', -- 이름
  GEN   VARCHAR(2)   NOT NULL COMMENT '성별', -- 성별
  BTH   DATE         NOT NULL COMMENT '생년월일', -- 생년월일
  AGC   VARCHAR(10)  NOT NULL COMMENT '통신사', -- 통신사
  TEL   VARCHAR(30)  NOT NULL COMMENT '핸드폰번호', -- 핸드폰번호
  GRA   INTEGER      NOT NULL COMMENT '등급', -- 등급
  EAUTH VARCHAR(10)  NULL     COMMENT '이메일인증', -- 이메일인증
  PROF  VARCHAR(255) NULL     COMMENT '프로필사진' -- 프로필사진
)
COMMENT '회원';

-- 회원
ALTER TABLE MEMBER
  ADD CONSTRAINT PK_MEMBER -- 회원 기본키
    PRIMARY KEY (
      MNO -- 회원번호
    );

-- 회원 유니크 인덱스
CREATE UNIQUE INDEX UIX_MEMBER
  ON MEMBER ( -- 회원
    EMAIL ASC -- 이메일
  );

ALTER TABLE MEMBER
  MODIFY COLUMN MNO INTEGER NOT NULL AUTO_INCREMENT COMMENT '회원번호';

-- 펫시터
CREATE TABLE petsitter (
  PNO    INTEGER      NOT NULL COMMENT '펫시터회원번호', -- 펫시터회원번호
  NICK   VARCHAR(100) NOT NULL COMMENT '닉네임', -- 닉네임
  AMT    INTEGER      NOT NULL COMMENT '가격', -- 가격
  KTALK  VARCHAR(40)  NOT NULL COMMENT '카톡', -- 카톡
  REG    VARCHAR(255) NOT NULL COMMENT '활동지역', -- 활동지역
  BANK   VARCHAR(20)  NOT NULL COMMENT '은행', -- 은행
  BKNM   VARCHAR(20)  NOT NULL COMMENT '예금주', -- 예금주
  ACC    VARCHAR(20)  NOT NULL COMMENT '계좌', -- 계좌
  SER    TEXT         NULL     COMMENT '추가서비스', -- 추가서비스
  INQUR  VARCHAR(20)  NOT NULL COMMENT '문의시간', -- 문의시간
  PET    VARCHAR(20)  NULL     DEFAULT 0 COMMENT '반려동물유무', -- 반려동물유무
  ADDR_1 VARCHAR(255) NOT NULL COMMENT '우편번호', -- 우편번호
  ADDR_2 VARCHAR(255) NOT NULL COMMENT '상세주소', -- 상세주소
  ADDR_3 VARCHAR(255) NOT NULL COMMENT '상세주소2', -- 상세주소
  RAD    INTEGER      NULL     DEFAULT 0 COMMENT '반지름', -- 반지름
  LAT    VARCHAR(20)  NULL     COMMENT '위도', -- 위도
  LNT    VARCHAR(20)  NULL     COMMENT '경도', -- 경도
  HOS    INTEGER      NOT NULL COMMENT '동물병원', -- 동물병원
  INTRO  TEXT         NOT NULL COMMENT '소개', -- 소개
  LIKES  INTEGER      NULL     DEFAULT 0 COMMENT '좋아요', -- 좋아요
  PETG   INTEGER      NULL     DEFAULT 1 COMMENT '펫시터등급', -- 펫시터등급
  IMG    VARCHAR(255) NULL     COMMENT '사진' -- 사진
)
COMMENT '펫시터';

-- 펫시터
ALTER TABLE petsitter
  ADD CONSTRAINT PK_petsitter -- 펫시터 기본키2
    PRIMARY KEY (
      PNO -- 펫시터회원번호
    );

-- 신청
CREATE TABLE request (
  REQ   INTEGER      NOT NULL COMMENT '신청번호', -- 신청번호
  MNO   INTEGER      NOT NULL COMMENT '회원번호', -- 회원번호
  PNO   INTEGER      NOT NULL COMMENT '펫시터회원번호', -- 펫시터회원번호
  CONTS DATE         NULL     COMMENT '상세정보', -- 상세정보
  MEAL  TEXT         NULL     COMMENT '밥먹는시간', -- 밥먹는시간
  TRAIN TEXT         NULL     COMMENT '교육', -- 교육
  ANS   TEXT         NULL     COMMENT '답변', -- 답변
  DATE  VARCHAR(100) NOT NULL COMMENT '신청날짜', -- 신청날짜
  RES   VARCHAR(12)  NOT NULL COMMENT '기관등록', -- 기관등록
  NEUT  VARCHAR(12)  NOT NULL COMMENT '중성화', -- 중성화
  ANIFD VARCHAR(12)  NOT NULL COMMENT '동물친화성', -- 동물친화성
  MANFD VARCHAR(12)  NOT NULL COMMENT '인간친화성', -- 인간친화성
  BARK  VARCHAR(12)  NOT NULL COMMENT '짖다', -- 짖다
  DIZ   VARCHAR(12)  NOT NULL COMMENT '질병', -- 질병
  STAT  VARCHAR(12)  NOT NULL DEFAULT '대기' COMMENT '상태' -- 상태
)
COMMENT '신청';

-- 신청
ALTER TABLE request
  ADD CONSTRAINT PK_request -- 신청 기본키
    PRIMARY KEY (
      REQ -- 신청번호
    );

ALTER TABLE request
  MODIFY COLUMN REQ INTEGER NOT NULL AUTO_INCREMENT COMMENT '신청번호';

-- 사용자후기
CREATE TABLE userreview (
  MBNO INTEGER NOT NULL COMMENT '게시물번호', -- 게시물번호
  PNO  INTEGER NULL     COMMENT '펫시터회원번호', -- 펫시터회원번호
  MNO  INTEGER NOT NULL COMMENT '회원번호', -- 회원번호
  BREV TEXT    NOT NULL COMMENT '글', -- 글
  BDT  DATETIME    NULL     COMMENT '날짜' -- 날짜
)
COMMENT '사용자후기';

-- 사용자후기
ALTER TABLE userreview
  ADD CONSTRAINT PK_userreview -- 사용자후기 기본키
    PRIMARY KEY (
      MBNO -- 게시물번호
    );

ALTER TABLE userreview
  MODIFY COLUMN MBNO INTEGER NOT NULL AUTO_INCREMENT COMMENT '게시물번호';

-- 좋아요
CREATE TABLE likes (
  PNO INTEGER NOT NULL COMMENT '펫시터회원번호', -- 펫시터회원번호
  MNO INTEGER NOT NULL COMMENT '사용자번호' -- 사용자번호
)
COMMENT '좋아요';

CREATE TABLE UPPHOTO (
  PNO   INTEGER      NOT NULL COMMENT '회원번호', -- 회원번호
  PATH  VARCHAR(255) not NULL COMMENT '업로드경로', -- 업로드경로
  PTOS  VARCHAR(255) not NULL COMMENT '업로드사진' -- 업로드사진
);
CREATE UNIQUE INDEX UIX_UPPHOTO
  ON UPPHOTO ( -- 사진
    PNO ASC, -- 펫시터넘버
    PTOS ASC -- 사진이름
  );
  
-- 멤버가 삭제되면 멤버와 같은 펫시터 삭제
alter table petsitter add foreign key (pno) references testdb.member (mno) on delete cascade on update cascade;
-- 좋아요 누른 회원이 사라지면 좋아요 삭제
alter table likes add foreign key (pno) references testdb.member (mno) on delete cascade on update cascade;
-- 좋아요 눌린 펫시터가 사라지면 좋아요 삭제
alter table likes add foreign key (pno) references testdb.petsitter (pno) on delete cascade on update cascade;
-- 후기가 펫시터가 사라지면 글 삭제
alter table userreview add foreign key (pno) references testdb.petsitter (pno) on delete cascade on update cascade;
-- 후기가 회원이 탈퇴하면 글 삭제
alter table userreview add foreign key (mbno) references testdb.petsitter (mno) on delete cascade on update cascade;
-- 올린 사진을 펫시터가 펫시터를 그만두면 삭제.
alter table upphoto add foreign key (pno) references testdb.petsitter (pno) on delete cascade on update cascade;


-- 여성멤버
Insert into Member (email, pwd, name, gen, bth, agc, tel, gra ) values('eunyoung@gmail.com','111a','김은영','여성','1982-05-23','SKT','010-1267-1452','1')
Insert into Member (email, pwd, name, gen, bth, agc, tel, gra ) values('heeju@hanmail.net','111a','김희주','여성','1985-07-20','SKT','010-8237-1232','1')
Insert into Member (email, pwd, name, gen, bth, agc, tel, gra ) values('eunseo@gmail.com','111a','나은서','여성','1981-04-21','LG U+','010-5667-1442','1')
Insert into Member (email, pwd, name, gen, bth, agc, tel, gra ) values('silversnow@naver.com','111a','백은설','여성','1981-12-20','LG U+','010-8667-1662','1')
Insert into Member (email, pwd, name, gen, bth, agc, tel, gra ) values('jena@gmail.com','111a','이예나','여성','1991-11-12','KT','010-5796-9646','1')
Insert into Member (email, pwd, name, gen, bth, agc, tel, gra ) values('Ayeong@naver.com','111a','박아영','여성','1995-01-18','LG U+','010-8767-1642','1')
Insert into Member (email, pwd, name, gen, bth, agc, tel, gra ) values('LeeEun@naver.com','111a','함이은','여성','1989-05-10','SKT','010-6474-1743','1')
Insert into Member (email, pwd, name, gen, bth, agc, tel, gra ) values('Iniesta@hanmail.net','111a','안인혜','여성','1987-01-23','KT','010-3947-2487','1')
Insert into Member (email, pwd, name, gen, bth, agc, tel, gra ) values('seungA@gmail.com','111a','배승아','여성','1981-07-20','SKT','010-1923-1486','1')
Insert into Member (email, pwd, name, gen, bth, agc, tel, gra ) values('kimsina@gmail.com','111a','김신아','여성','1983-02-24','LG U+','010-4532-4680','1')
Insert into Member (email, pwd, name, gen, bth, agc, tel, gra ) values('songhee@gmail.com','111a','배송희','여성','1987-01-22','KT','010-4531-6786','1')
Insert into Member (email, pwd, name, gen, bth, agc, tel, gra ) values('soyeon@naver.com','111a','이소연','여성','1983-11-11','LG U+','010-7453-8564','1')
Insert into Member (email, pwd, name, gen, bth, agc, tel, gra ) values('Yu-jin@gmail.com','111a','이유진','여성','1992-03-25','SKT','010-9841-1234','1')
Insert into Member (email, pwd, name, gen, bth, agc, tel, gra ) values('se-eun@naver.com','111a','윤세은','여성','1990-06-12','LG U+','010-3853-5435','1')
Insert into Member (email, pwd, name, gen, bth, agc, tel, gra ) values('seunghee@hanmail.net','111a','김승희','여성','1995-07-12','SKT','010-1235-4312','1')


